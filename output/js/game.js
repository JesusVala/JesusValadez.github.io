var te=Object.defineProperty;var l=(o,n)=>te(o,"name",{value:n,configurable:!0});var v=new THREE.Color().setHex(8900331),oe=-100,ne=-100,k=500,z=50*Math.PI/180,W=20*Math.PI/180,ae=10*Math.PI/180,Y=-Math.tan(z)*500,ie=Math.tan(W)*Math.sqrt(500**2+Y**2),s=Object.freeze({DIR_LIGHT:{POSITION:{X:oe,Y:ne},SHADOW:{CAMERA:{LEFT:-k,RIGHT:k,TOP:k,BOTTON:-k}}},CAMERA:{ROTATION:{X:z,Y:W,Z:ae},POSITION:{X:ie,Y}}}),g=15,c=42,m=17,E=c*m,D=["car","truck","forest"],A=[2,2.5,3];var X=[20,45,60];function Z(){let o=new THREE.Group,n=new THREE.Mesh(new THREE.BoxBufferGeometry(15*2,15*2,20*2),new THREE.MeshPhongMaterial({color:5056806,flatShading:!0}));n.position.z=10*2,n.castShadow=!0,n.receiveShadow=!0,o.add(n);let t=X[Math.floor(Math.random()*X.length)],a=new THREE.Mesh(new THREE.BoxBufferGeometry(30*2,30*2,t*2),new THREE.MeshLambertMaterial({color:8036893,flatShading:!0}));return a.position.z=(t/2+20)*2,a.castShadow=!0,a.receiveShadow=!1,o.add(a),o}l(Z,"Three");function C(){let o=new THREE.Group,t=l(a=>new THREE.Mesh(new THREE.BoxBufferGeometry(E*2,c*2,3*2),new THREE.MeshPhongMaterial({color:a})),"createSection")(12252245);return t.receiveShadow=!0,o.add(t),o.position.z=1.5*2,o}l(C,"Grass");function B(){let o=new THREE.Group,n=l(i=>new THREE.Mesh(new THREE.PlaneBufferGeometry(E*2,c*2),new THREE.MeshPhongMaterial({color:i})),"createSection"),t=n(4541017);t.receiveShadow=!0,o.add(t);let a=n(3751241);a.position.x=-E*2,o.add(a);let r=n(3751241);return r.position.x=E*2,o.add(r),o}l(B,"Road");var N=[10822947,12432952,7909707],re=new S(40,80,[{x:0,y:10,w:30,h:60}]),se=new S(40,80,[{x:10,y:10,w:30,h:60}]),ce=new S(110,40,[{x:10,y:0,w:50,h:30},{x:70,y:0,w:30,h:30}]),he=new S(110,40,[{x:10,y:10,w:50,h:30},{x:70,y:10,w:30,h:30}]),le=new S(30,30,[{x:15,y:0,w:10,h:30}]),de=new S(25,30,[{x:0,y:15,w:10,h:10}]),fe=new S(25,30,[{x:0,y:5,w:10,h:10}]);function F(){let o=new THREE.Group,n=N[Math.floor(Math.random()*N.length)],t=new THREE.Mesh(new THREE.BoxBufferGeometry(60*2,30*2,15*2),new THREE.MeshPhongMaterial({color:n,flatShading:!0}));t.position.z=12*2,t.castShadow=!0,t.receiveShadow=!0,o.add(t);let a=new THREE.Mesh(new THREE.BoxBufferGeometry(33*2,24*2,12*2),[new THREE.MeshPhongMaterial({color:13421772,flatShading:!0,map:se}),new THREE.MeshPhongMaterial({color:13421772,flatShading:!0,map:re}),new THREE.MeshPhongMaterial({color:13421772,flatShading:!0,map:ce}),new THREE.MeshPhongMaterial({color:13421772,flatShading:!0,map:he}),new THREE.MeshPhongMaterial({color:13421772,flatShading:!0}),new THREE.MeshPhongMaterial({color:13421772,flatShading:!0})]);a.position.x=6*2,a.position.z=25.5*2,a.castShadow=!0,a.receiveShadow=!0,o.add(a);let r=new P;r.position.x=-18*2,o.add(r);let i=new P;return i.position.x=18*2,o.add(i),o.castShadow=!0,o.receiveShadow=!1,o}l(F,"Car");function U(){let o=new THREE.Group,n=N[Math.floor(Math.random()*N.length)],t=new THREE.Mesh(new THREE.BoxBufferGeometry(100*2,25*2,5*2),new THREE.MeshLambertMaterial({color:11847420,flatShading:!0}));t.position.z=10*2,o.add(t);let a=new THREE.Mesh(new THREE.BoxBufferGeometry(75*2,35*2,40*2),new THREE.MeshPhongMaterial({color:11847420,flatShading:!0}));a.position.x=15*2,a.position.z=30*2,a.castShadow=!0,a.receiveShadow=!0,o.add(a);let r=new THREE.Mesh(new THREE.BoxBufferGeometry(25*2,30*2,30*2),[new THREE.MeshPhongMaterial({color:n,flatShading:!0}),new THREE.MeshPhongMaterial({color:n,flatShading:!0,map:le}),new THREE.MeshPhongMaterial({color:n,flatShading:!0,map:de}),new THREE.MeshPhongMaterial({color:n,flatShading:!0,map:fe}),new THREE.MeshPhongMaterial({color:n,flatShading:!0}),new THREE.MeshPhongMaterial({color:n,flatShading:!0})]);r.position.x=-40*2,r.position.z=20*2,r.castShadow=!0,r.receiveShadow=!0,o.add(r);let i=new P;i.position.x=-38*2,o.add(i);let b=new P;b.position.x=-10*2,o.add(b);let _=new P;return _.position.x=30*2,o.add(_),o}l(U,"Truck");function P(){let o=new THREE.Mesh(new THREE.BoxBufferGeometry(12*2,33*2,12*2),new THREE.MeshLambertMaterial({color:3355443,flatShading:!0}));return o.position.z=6*2,o}l(P,"Wheel");function S(o,n,t){let a=document.createElement("canvas");a.width=o,a.height=n;let r=a.getContext("2d");return r.fillStyle="#ffffff",r.fillRect(0,0,o,n),r.fillStyle="rgba(0,0,0,0.6)",t.forEach(i=>{r.fillRect(i.x,i.y,i.w,i.h)}),new THREE.CanvasTexture(a)}l(S,"Texture");var q=l(o=>[-9,-8,-7,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7,8,9].map(n=>{let t=new j(n);return t.mesh.position.y=n*c*2,o.add(t.mesh),t}).filter(n=>n.index>=0),"generateLanes"),V=l((o,n)=>{let t=n.length,a=new j(t);a.mesh.position.y=t*c*2,o.add(a.mesh),n.push(a)},"addLane");function j(o){switch(this.index=o,this.type=o<=0?"field":D[Math.floor(Math.random()*D.length)],this.type){case"field":{this.type="field",this.mesh=new C;break}case"forest":{this.mesh=new C,this.occupiedPositions=new Set,this.threes=[1,2,3,4].map(()=>{let n=new Z,t;do t=Math.floor(Math.random()*m);while(this.occupiedPositions.has(t));return this.occupiedPositions.add(t),n.position.x=(t*c+c/2)*2-E*2/2,this.mesh.add(n),n});break}case"car":{this.mesh=new B,this.direction=Math.random()>=.5;let n=new Set;this.vechicles=[1,2,3].map(()=>{let t=new F,a;do a=Math.floor(Math.random()*m/2);while(n.has(a));return n.add(a),t.position.x=(a*c*2+c/2)*2-E*2/2,this.direction||(t.rotation.z=Math.PI),this.mesh.add(t),t}),this.speed=A[Math.floor(Math.random()*A.length)];break}case"truck":{this.mesh=new B,this.direction=Math.random()>=.5;let n=new Set;this.vechicles=[1,2].map(()=>{let t=new U,a;do a=Math.floor(Math.random()*m/3);while(n.has(a));return n.add(a),t.position.x=(a*c*3+c/2)*2-E*2/2,this.direction||(t.rotation.z=Math.PI),this.mesh.add(t),t}),this.speed=A[Math.floor(Math.random()*A.length)];break}}}l(j,"Lane");function K(){let o=new THREE.Group,n=new THREE.Mesh(new THREE.BoxBufferGeometry(g*2,g*2,20*2),new THREE.MeshPhongMaterial({color:16777215,flatShading:!0}));n.position.z=10*2,n.castShadow=!0,n.receiveShadow=!0,o.add(n);let t=new THREE.Mesh(new THREE.BoxBufferGeometry(2*2,4*2,2*2),new THREE.MeshLambertMaterial({color:15753626,flatShading:!0}));return t.position.z=21*2,t.castShadow=!0,t.receiveShadow=!1,o.add(t),o}l(K,"Player");var J=document.getElementById("counter"),Q=document.getElementById("end"),M=new THREE.Scene;M.background=v;var u=new THREE.OrthographicCamera(globalThis.innerWidth/-2,globalThis.innerWidth/2,globalThis.innerHeight/2,globalThis.innerHeight/-2,.1,1e4);u.rotation.x=s.CAMERA.ROTATION.X;u.rotation.y=s.CAMERA.ROTATION.Y;u.rotation.z=s.CAMERA.ROTATION.Z;u.position.y=s.CAMERA.POSITION.Y;u.position.x=s.CAMERA.POSITION.X;u.position.z=500;var d,T,H,I,y,O,x,w,h=new K;M.add(h);var ue=new THREE.HemisphereLight(16777215,16777215,.6);M.add(ue);var f=new THREE.DirectionalLight(16777215,.6);f.position.set(s.DIR_LIGHT.POSITION.X,s.DIR_LIGHT.POSITION.Y,200);f.castShadow=!0;f.target=h;M.add(f);f.shadow.mapSize.width=2048;f.shadow.mapSize.height=2048;f.shadow.camera.left=s.DIR_LIGHT.SHADOW.CAMERA.LEFT;f.shadow.camera.right=s.DIR_LIGHT.SHADOW.CAMERA.RIGHT;f.shadow.camera.top=s.DIR_LIGHT.SHADOW.CAMERA.TOP;f.shadow.camera.bottom=s.DIR_LIGHT.SHADOW.CAMERA.BOTTON;var G=new THREE.DirectionalLight(0,.4);G.position.set(200,200,50);G.castShadow=!0;M.add(G);var $=l(()=>{d=q(M),T=0,H=Math.floor(m/2),y=null,O=!1,x=[],w="forward",h.position.x=0,h.position.y=0,u.position.y=s.CAMERA.POSITION.Y,u.position.x=s.CAMERA.POSITION.X,f.position.x=s.DIR_LIGHT.POSITION.X,f.position.y=s.DIR_LIGHT.POSITION.Y},"initaliseValues");$();var L=new THREE.WebGLRenderer({alpha:!0,antialias:!0});L.shadowMap.enabled=!0;L.shadowMap.type=THREE.PCFSoftShadowMap;L.setSize(globalThis.innerWidth,globalThis.innerHeight);document.body.appendChild(L.domElement);function R(o){if(x.length>=2)return;let n=x.reduce((t,a)=>{if(a==="forward")return{lane:t.lane+1,column:t.column};if(a==="backward")return{lane:t.lane-1,column:t.column};if(a==="left")return{lane:t.lane,column:t.column-1};if(a==="right")return{lane:t.lane,column:t.column+1}},{lane:T,column:H});if(o==="forward"){if(d[n.lane+1].type==="forest"&&d[n.lane+1].occupiedPositions.has(n.column))return;I||(O=!0),V(M,d)}else if(o==="backward"){if(n.lane===0||d[n.lane-1].type==="forest"&&d[n.lane-1].occupiedPositions.has(n.column))return;I||(O=!0)}else if(o==="left"){if(n.column===0||d[n.lane].type==="forest"&&d[n.lane].occupiedPositions.has(n.column-1))return;I||(O=!0)}else if(o==="right"){if(n.column===m-1||d[n.lane].type==="forest"&&d[n.lane].occupiedPositions.has(n.column+1))return;I||(O=!0)}x.push(o)}l(R,"move");document.querySelector("#retry").addEventListener("click",()=>{d.forEach(o=>M.remove(o.mesh)),$(),Q.style.visibility="hidden"});document.getElementById("forward").addEventListener("click",()=>R("forward"));document.getElementById("backward").addEventListener("click",()=>R("backward"));document.getElementById("left").addEventListener("click",()=>R("left"));document.getElementById("right").addEventListener("click",()=>R("right"));globalThis.addEventListener("keydown",o=>{o.keyCode=="38"?R("forward"):o.keyCode=="40"?R("backward"):o.keyCode=="37"?R("left"):o.keyCode=="39"&&R("right")});function ee(o){requestAnimationFrame(ee),y||(y=o);let n=o-y;if(y=o,d.forEach(t=>{if(t.type==="car"||t.type==="truck"){let a=-E*2/2-c*2*2,r=E*2/2+c*2*2;t.vechicles.forEach(i=>{t.direction?i.position.x=i.position.x<a?r:i.position.x-=t.speed/16*n:i.position.x=i.position.x>r?a:i.position.x+=t.speed/16*n})}}),O&&(I=o,O=!1),I){let t=o-I,a=Math.min(t/200,1)*c*2,r=Math.sin(Math.min(t/200,1)*Math.PI)*8*2;switch(x[0]){case"forward":{let i=T*c*2+a;switch(u.position.y=s.CAMERA.POSITION.Y+i,f.position.y=s.DIR_LIGHT.POSITION.Y+i,h.position.y=i,h.position.z=r,w){case"forward":break;case"left":h.rotation.z=-Math.min(t/200,1)*Math.PI;break;default:h.rotation.z=Math.min(t/200,1)*Math.PI;break}break}case"backward":{let i=T*c*2-a;switch(u.position.y=s.CAMERA.POSITION.Y+i,f.position.y=s.DIR_LIGHT.POSITION.Y+i,h.position.y=i,h.position.z=r,w){case"backward":break;case"left":h.rotation.z=Math.min(t/200,1)*Math.PI;break;default:h.rotation.z=-Math.min(t/200,1)*Math.PI;break}break}case"left":{let i=(H*c+c/2)*2-E*2/2-a;switch(u.position.x=s.CAMERA.POSITION.X+i,f.position.x=s.DIR_LIGHT.POSITION.X+i,h.position.x=i,h.position.z=r,w){case"left":break;case"forward":h.rotation.z=Math.min(t/200,1)*Math.PI/2;break;default:h.rotation.z=-Math.min(t/200,1)*Math.PI/2;break}break}case"right":{let i=(H*c+c/2)*2-E*2/2+a;switch(u.position.x=s.CAMERA.POSITION.X+i,f.position.x=s.DIR_LIGHT.POSITION.X+i,h.position.x=i,h.position.z=r,w){case"right":break;case"forward":h.rotation.z=-Math.min(t/200,1)*Math.PI/2;break;default:h.rotation.z=Math.min(t/200,1)*Math.PI/2;break}break}}if(t>200){switch(x[0]){case"forward":{T++,J.innerHTML=T,w="forward";break}case"backward":{T--,J.innerHTML=T,w="backward";break}case"left":{H--,w="left";break}case"right":{H++,w="right";break}}x.shift(),I=x.length===0?null:o}}if(d[T].type==="car"||d[T].type==="truck"){let t=h.position.x-g*2/2,a=h.position.x+g*2/2,r={car:60,truck:105}[d[T].type];d[T].vechicles.forEach(i=>{let b=i.position.x-r*2/2,_=i.position.x+r*2/2;a>b&&t<_&&(Q.style.visibility="visible")})}L.render(M,u)}l(ee,"animate");requestAnimationFrame(ee);
