var J=Object.defineProperty;var h=(t,o)=>J(t,"name",{value:o,configurable:!0});var B=50*Math.PI/180,G=20*Math.PI/180,K=10*Math.PI/180,v=-Math.tan(B)*500,Q=Math.tan(G)*Math.sqrt(500**2+v**2),s=Object.freeze({DIR_LIGHT:{POSITION:{X:-100,Y:-100},SHADOW:{CAMERA:{LEFT:-500,RIGHT:500,TOP:500,BOTTON:-500}}},CAMERA:{ROTATION:{X:B,Y:G,Z:K},POSITION:{X:Q,Y:v}}}),S=15,c=42,p=17,l=c*p,D=["car","truck","forest"],H=[2,2.5,3];var W=[20,45,60];function Y(){let t=new THREE.Group,o=new THREE.Mesh(new THREE.BoxBufferGeometry(15*2,15*2,20*2),new THREE.MeshPhongMaterial({color:5056806,flatShading:!0}));o.position.z=10*2,o.castShadow=!0,o.receiveShadow=!0,t.add(o);let n=W[Math.floor(Math.random()*W.length)],i=new THREE.Mesh(new THREE.BoxBufferGeometry(30*2,30*2,n*2),new THREE.MeshLambertMaterial({color:8036893,flatShading:!0}));return i.position.z=(n/2+20)*2,i.castShadow=!0,i.receiveShadow=!1,t.add(i),t}h(Y,"Three");function N(){let t=new THREE.Group,o=h(r=>new THREE.Mesh(new THREE.BoxBufferGeometry(l*2,c*2,3*2),new THREE.MeshPhongMaterial({color:r})),"createSection"),n=o(12252245);n.receiveShadow=!0,t.add(n);let i=o(10078278);i.position.x=-l*2,t.add(i);let a=o(10078278);return a.position.x=l*2,t.add(a),t.position.z=1.5*2,t}h(N,"Grass");function b(){let t=new THREE.Group,o=h(r=>new THREE.Mesh(new THREE.PlaneBufferGeometry(l*2,c*2),new THREE.MeshPhongMaterial({color:r})),"createSection"),n=o(4541017);n.receiveShadow=!0,t.add(n);let i=o(3751241);i.position.x=-l*2,t.add(i);let a=o(3751241);return a.position.x=l*2,t.add(a),t}h(b,"Road");var y=[10822947,12432952,7909707],$=new m(40,80,[{x:0,y:10,w:30,h:60}]),ee=new m(40,80,[{x:10,y:10,w:30,h:60}]),te=new m(110,40,[{x:10,y:0,w:50,h:30},{x:70,y:0,w:30,h:30}]),oe=new m(110,40,[{x:10,y:10,w:50,h:30},{x:70,y:10,w:30,h:30}]),ne=new m(30,30,[{x:15,y:0,w:10,h:30}]),ie=new m(25,30,[{x:0,y:15,w:10,h:10}]),re=new m(25,30,[{x:0,y:5,w:10,h:10}]);function X(){let t=new THREE.Group,o=y[Math.floor(Math.random()*y.length)],n=new THREE.Mesh(new THREE.BoxBufferGeometry(60*2,30*2,15*2),new THREE.MeshPhongMaterial({color:o,flatShading:!0}));n.position.z=12*2,n.castShadow=!0,n.receiveShadow=!0,t.add(n);let i=new THREE.Mesh(new THREE.BoxBufferGeometry(33*2,24*2,12*2),[new THREE.MeshPhongMaterial({color:13421772,flatShading:!0,map:ee}),new THREE.MeshPhongMaterial({color:13421772,flatShading:!0,map:$}),new THREE.MeshPhongMaterial({color:13421772,flatShading:!0,map:te}),new THREE.MeshPhongMaterial({color:13421772,flatShading:!0,map:oe}),new THREE.MeshPhongMaterial({color:13421772,flatShading:!0}),new THREE.MeshPhongMaterial({color:13421772,flatShading:!0})]);i.position.x=6*2,i.position.z=25.5*2,i.castShadow=!0,i.receiveShadow=!0,t.add(i);let a=new A;a.position.x=-18*2,t.add(a);let r=new A;return r.position.x=18*2,t.add(r),t.castShadow=!0,t.receiveShadow=!1,t}h(X,"Car");function z(){let t=new THREE.Group,o=y[Math.floor(Math.random()*y.length)],n=new THREE.Mesh(new THREE.BoxBufferGeometry(100*2,25*2,5*2),new THREE.MeshLambertMaterial({color:11847420,flatShading:!0}));n.position.z=10*2,t.add(n);let i=new THREE.Mesh(new THREE.BoxBufferGeometry(75*2,35*2,40*2),new THREE.MeshPhongMaterial({color:11847420,flatShading:!0}));i.position.x=15*2,i.position.z=30*2,i.castShadow=!0,i.receiveShadow=!0,t.add(i);let a=new THREE.Mesh(new THREE.BoxBufferGeometry(25*2,30*2,30*2),[new THREE.MeshPhongMaterial({color:o,flatShading:!0}),new THREE.MeshPhongMaterial({color:o,flatShading:!0,map:ne}),new THREE.MeshPhongMaterial({color:o,flatShading:!0,map:ie}),new THREE.MeshPhongMaterial({color:o,flatShading:!0,map:re}),new THREE.MeshPhongMaterial({color:o,flatShading:!0}),new THREE.MeshPhongMaterial({color:o,flatShading:!0})]);a.position.x=-40*2,a.position.z=20*2,a.castShadow=!0,a.receiveShadow=!0,t.add(a);let r=new A;r.position.x=-38*2,t.add(r);let L=new A;L.position.x=-10*2,t.add(L);let P=new A;return P.position.x=30*2,t.add(P),t}h(z,"Truck");function A(){let t=new THREE.Mesh(new THREE.BoxBufferGeometry(12*2,33*2,12*2),new THREE.MeshLambertMaterial({color:3355443,flatShading:!0}));return t.position.z=6*2,t}h(A,"Wheel");function m(t,o,n){let i=document.createElement("canvas");i.width=t,i.height=o;let a=i.getContext("2d");return a.fillStyle="#ffffff",a.fillRect(0,0,t,o),a.fillStyle="rgba(0,0,0,0.6)",n.forEach(r=>{a.fillRect(r.x,r.y,r.w,r.h)}),new THREE.CanvasTexture(i)}h(m,"Texture");var Z=h(t=>[-9,-8,-7,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7,8,9].map(o=>{let n=new ae(o);return n.mesh.position.y=o*c*2,t.add(n.mesh),n}).filter(o=>o.index>=0),"generateLanes");function ae(t){switch(this.index=t,this.type=t<=0?"field":D[Math.floor(Math.random()*D.length)],this.type){case"field":{this.type="field",this.mesh=new N;break}case"forest":{this.mesh=new N,this.occupiedPositions=new Set,this.threes=[1,2,3,4].map(()=>{let o=new Y,n;do n=Math.floor(Math.random()*p);while(this.occupiedPositions.has(n));return this.occupiedPositions.add(n),o.position.x=(n*c+c/2)*2-l*2/2,this.mesh.add(o),o});break}case"car":{this.mesh=new b,this.direction=Math.random()>=.5;let o=new Set;this.vechicles=[1,2,3].map(()=>{let n=new X,i;do i=Math.floor(Math.random()*p/2);while(o.has(i));return o.add(i),n.position.x=(i*c*2+c/2)*2-l*2/2,this.direction||(n.rotation.z=Math.PI),this.mesh.add(n),n}),this.speed=H[Math.floor(Math.random()*H.length)];break}case"truck":{this.mesh=new b,this.direction=Math.random()>=.5;let o=new Set;this.vechicles=[1,2].map(()=>{let n=new z,i;do i=Math.floor(Math.random()*p/3);while(o.has(i));return o.add(i),n.position.x=(i*c*3+c/2)*2-l*2/2,this.direction||(n.rotation.z=Math.PI),this.mesh.add(n),n}),this.speed=H[Math.floor(Math.random()*H.length)];break}}}h(ae,"Lane");function F(){let t=new THREE.Group,o=new THREE.Mesh(new THREE.BoxBufferGeometry(S*2,S*2,20*2),new THREE.MeshPhongMaterial({color:16777215,flatShading:!0}));o.position.z=10*2,o.castShadow=!0,o.receiveShadow=!0,t.add(o);let n=new THREE.Mesh(new THREE.BoxBufferGeometry(2*2,4*2,2*2),new THREE.MeshLambertMaterial({color:15753626,flatShading:!0}));return n.position.z=21*2,n.castShadow=!0,n.receiveShadow=!1,t.add(n),t}h(F,"Player");var q=document.getElementById("counter"),U=document.getElementById("end"),R=new THREE.Scene,E=new THREE.OrthographicCamera(globalThis.innerWidth/-2,globalThis.innerWidth/2,globalThis.innerHeight/2,globalThis.innerHeight/-2,.1,1e4);E.rotation.x=s.CAMERA.ROTATION.X;E.rotation.y=s.CAMERA.ROTATION.Y;E.rotation.z=s.CAMERA.ROTATION.Z;E.position.y=s.CAMERA.POSITION.Y;E.position.x=s.CAMERA.POSITION.X;E.position.z=500;var T,I,O,g,x,w,u,f=new F;R.add(f);var ce=new THREE.HemisphereLight(16777215,16777215,.6);R.add(ce);var d=new THREE.DirectionalLight(16777215,.6);d.position.set(s.DIR_LIGHT.POSITION.X,s.DIR_LIGHT.POSITION.Y,200);d.castShadow=!0;d.target=f;R.add(d);d.shadow.mapSize.width=2048;d.shadow.mapSize.height=2048;d.shadow.camera.left=s.DIR_LIGHT.SHADOW.CAMERA.LEFT;d.shadow.camera.right=s.DIR_LIGHT.SHADOW.CAMERA.RIGHT;d.shadow.camera.top=s.DIR_LIGHT.SHADOW.CAMERA.TOP;d.shadow.camera.bottom=s.DIR_LIGHT.SHADOW.CAMERA.BOTTON;var k=new THREE.DirectionalLight(0,.4);k.position.set(200,200,50);k.castShadow=!0;R.add(k);var V=h(()=>{T=Z(R),I=0,O=Math.floor(p/2),g=null,x=!1,w=[],f.position.x=0,f.position.y=0,E.position.y=s.CAMERA.POSITION.Y,E.position.x=s.CAMERA.POSITION.X,d.position.x=s.DIR_LIGHT.POSITION.X,d.position.y=s.DIR_LIGHT.POSITION.Y},"initaliseValues");V();var _=new THREE.WebGLRenderer({alpha:!0,antialias:!0});_.shadowMap.enabled=!0;_.shadowMap.type=THREE.PCFSoftShadowMap;_.setSize(globalThis.innerWidth,globalThis.innerHeight);document.body.appendChild(_.domElement);function M(t){if(w.length>=2)return;let o=w.reduce((n,i)=>{if(i==="forward")return{lane:n.lane+1,column:n.column};if(i==="backward")return{lane:n.lane-1,column:n.column};if(i==="left")return{lane:n.lane,column:n.column-1};if(i==="right")return{lane:n.lane,column:n.column+1}},{lane:I,column:O});if(t==="forward"){if(T[o.lane+1].type==="forest"&&T[o.lane+1].occupiedPositions.has(o.column))return;u||(x=!0)}else if(t==="backward"){if(o.lane===0||T[o.lane-1].type==="forest"&&T[o.lane-1].occupiedPositions.has(o.column))return;u||(x=!0)}else if(t==="left"){if(o.column===0||T[o.lane].type==="forest"&&T[o.lane].occupiedPositions.has(o.column-1))return;u||(x=!0)}else if(t==="right"){if(o.column===p-1||T[o.lane].type==="forest"&&T[o.lane].occupiedPositions.has(o.column+1))return;u||(x=!0)}w.push(t)}h(M,"move");document.querySelector("#retry").addEventListener("click",()=>{T.forEach(t=>R.remove(t.mesh)),V(),U.style.visibility="hidden"});document.getElementById("forward").addEventListener("click",()=>M("forward"));document.getElementById("backward").addEventListener("click",()=>M("backward"));document.getElementById("left").addEventListener("click",()=>M("left"));document.getElementById("right").addEventListener("click",()=>M("right"));globalThis.addEventListener("keydown",t=>{t.keyCode=="38"?M("forward"):t.keyCode=="40"?M("backward"):t.keyCode=="37"?M("left"):t.keyCode=="39"&&M("right")});function j(t){requestAnimationFrame(j),g||(g=t);let o=t-g;if(g=t,T.forEach(n=>{if(n.type==="car"||n.type==="truck"){let i=-l*2/2-c*2*2,a=l*2/2+c*2*2;n.vechicles.forEach(r=>{n.direction?r.position.x=r.position.x<i?a:r.position.x-=n.speed/16*o:r.position.x=r.position.x>a?i:r.position.x+=n.speed/16*o})}}),x&&(u=t,x=!1),u){let n=t-u,i=Math.min(n/200,1)*c*2,a=Math.sin(Math.min(n/200,1)*Math.PI)*8*2;switch(w[0]){case"forward":{let r=I*c*2+i;E.position.y=s.CAMERA.POSITION.Y+r,d.position.y=s.DIR_LIGHT.POSITION.Y+r,f.position.y=r,f.position.z=a;break}case"backward":{let r=I*c*2-i;E.position.y=s.CAMERA.POSITION.Y+r,d.position.y=s.DIR_LIGHT.POSITION.Y+r,f.position.y=r,f.position.z=a;break}case"left":{let r=(O*c+c/2)*2-l*2/2-i;E.position.x=s.CAMERA.POSITION.X+r,d.position.x=s.DIR_LIGHT.POSITION.X+r,f.position.x=r,f.position.z=a;break}case"right":{let r=(O*c+c/2)*2-l*2/2+i;E.position.x=s.CAMERA.POSITION.X+r,d.position.x=s.DIR_LIGHT.POSITION.X+r,f.position.x=r,f.position.z=a;break}}if(n>200){switch(w[0]){case"forward":{I++,q.innerHTML=I;break}case"backward":{I--,q.innerHTML=I;break}case"left":{O--;break}case"right":{O++;break}}w.shift(),u=w.length===0?null:t}}if(T[I].type==="car"||T[I].type==="truck"){let n=f.position.x-S*2/2,i=f.position.x+S*2/2,a={car:60,truck:105}[T[I].type];T[I].vechicles.forEach(r=>{let L=r.position.x-a*2/2,P=r.position.x+a*2/2;i>L&&n<P&&(U.style.visibility="visible")})}_.render(R,E)}h(j,"animate");requestAnimationFrame(j);
