var re=Object.defineProperty;var l=(o,n)=>re(o,"name",{value:n,configurable:!0});var Y=new THREE.Color().setHex(8900331),ie=-100,se=-100,_=500,K=50*Math.PI/180,F=20*Math.PI/180,ce=10*Math.PI/180,Z=-Math.tan(K)*500,he=Math.tan(F)*Math.sqrt(500**2+Z**2),d=Object.freeze({DIR_LIGHT:{POSITION:{X:ie,Y:se},SHADOW:{CAMERA:{LEFT:-_,RIGHT:_,TOP:_,BOTTON:-_}}},CAMERA:{ROTATION:{X:K,Y:F,Z:ce},POSITION:{X:he,Y:Z}}}),h=15,E=42,S=17,f=E*S,G=["car","truck","forest"],B=[2,2.5,3];var U=[20,45,60];function j(){let o=new THREE.Group,n=new THREE.Mesh(new THREE.BoxBufferGeometry(15*2,15*2,20*2),new THREE.MeshPhongMaterial({color:5056806,flatShading:!0}));n.position.z=10*2,n.castShadow=!0,n.receiveShadow=!0,o.add(n);let t=U[Math.floor(Math.random()*U.length)],a=new THREE.Mesh(new THREE.BoxBufferGeometry(30*2,30*2,t*2),new THREE.MeshLambertMaterial({color:8036893,flatShading:!0}));return a.position.z=(t/2+20)*2,a.castShadow=!0,a.receiveShadow=!1,o.add(a),o}l(j,"Three");function z(){let o=new THREE.Group,n=l(r=>new THREE.Mesh(new THREE.BoxBufferGeometry(f*2,E*2,3*2),new THREE.MeshPhongMaterial({color:r})),"createSection"),t=n(12252245);t.receiveShadow=!0,o.add(t);let a=n(10078278);a.position.x=-f*2,o.add(a);let i=n(10078278);return i.position.x=f*2,o.add(i),o.position.z=1.5*2,o}l(z,"Grass");function v(){let o=new THREE.Group,n=l(r=>new THREE.Mesh(new THREE.PlaneBufferGeometry(f*2,E*2),new THREE.MeshPhongMaterial({color:r})),"createSection"),t=n(4541017);t.receiveShadow=!0,o.add(t);let a=n(3751241);a.position.x=-f*2,o.add(a);let i=n(3751241);return i.position.x=f*2,o.add(i),o}l(v,"Road");var D=[10822947,12432952,7909707],le=new g(40,80,[{x:0,y:10,w:30,h:60}]),de=new g(40,80,[{x:10,y:10,w:30,h:60}]),Ee=new g(110,40,[{x:10,y:0,w:50,h:30},{x:70,y:0,w:30,h:30}]),fe=new g(110,40,[{x:10,y:10,w:50,h:30},{x:70,y:10,w:30,h:30}]),we=new g(30,30,[{x:15,y:0,w:10,h:30}]),Te=new g(25,30,[{x:0,y:15,w:10,h:10}]),ue=new g(25,30,[{x:0,y:5,w:10,h:10}]);function q(){let o=new THREE.Group,n=D[Math.floor(Math.random()*D.length)],t=new THREE.Mesh(new THREE.BoxBufferGeometry(60*2,30*2,15*2),new THREE.MeshPhongMaterial({color:n,flatShading:!0}));t.position.z=12*2,t.castShadow=!0,t.receiveShadow=!0,o.add(t);let a=new THREE.Mesh(new THREE.BoxBufferGeometry(33*2,24*2,12*2),[new THREE.MeshPhongMaterial({color:13421772,flatShading:!0,map:de}),new THREE.MeshPhongMaterial({color:13421772,flatShading:!0,map:le}),new THREE.MeshPhongMaterial({color:13421772,flatShading:!0,map:Ee}),new THREE.MeshPhongMaterial({color:13421772,flatShading:!0,map:fe}),new THREE.MeshPhongMaterial({color:13421772,flatShading:!0}),new THREE.MeshPhongMaterial({color:13421772,flatShading:!0})]);a.position.x=6*2,a.position.z=25.5*2,a.castShadow=!0,a.receiveShadow=!0,o.add(a);let i=new b;i.position.x=-18*2,o.add(i);let r=new b;return r.position.x=18*2,o.add(r),o.castShadow=!0,o.receiveShadow=!1,o}l(q,"Car");function V(){let o=new THREE.Group,n=D[Math.floor(Math.random()*D.length)],t=new THREE.Mesh(new THREE.BoxBufferGeometry(100*2,25*2,5*2),new THREE.MeshLambertMaterial({color:11847420,flatShading:!0}));t.position.z=10*2,o.add(t);let a=new THREE.Mesh(new THREE.BoxBufferGeometry(75*2,35*2,40*2),new THREE.MeshPhongMaterial({color:11847420,flatShading:!0}));a.position.x=15*2,a.position.z=30*2,a.castShadow=!0,a.receiveShadow=!0,o.add(a);let i=new THREE.Mesh(new THREE.BoxBufferGeometry(25*2,30*2,30*2),[new THREE.MeshPhongMaterial({color:n,flatShading:!0}),new THREE.MeshPhongMaterial({color:n,flatShading:!0,map:we}),new THREE.MeshPhongMaterial({color:n,flatShading:!0,map:Te}),new THREE.MeshPhongMaterial({color:n,flatShading:!0,map:ue}),new THREE.MeshPhongMaterial({color:n,flatShading:!0}),new THREE.MeshPhongMaterial({color:n,flatShading:!0})]);i.position.x=-40*2,i.position.z=20*2,i.castShadow=!0,i.receiveShadow=!0,o.add(i);let r=new b;r.position.x=-38*2,o.add(r);let R=new b;R.position.x=-10*2,o.add(R);let x=new b;return x.position.x=30*2,o.add(x),o}l(V,"Truck");function b(){let o=new THREE.Mesh(new THREE.BoxBufferGeometry(12*2,33*2,12*2),new THREE.MeshLambertMaterial({color:3355443,flatShading:!0}));return o.position.z=6*2,o}l(b,"Wheel");function g(o,n,t){let a=document.createElement("canvas");a.width=o,a.height=n;let i=a.getContext("2d");return i.fillStyle="#ffffff",i.fillRect(0,0,o,n),i.fillStyle="rgba(0,0,0,0.6)",t.forEach(r=>{i.fillRect(r.x,r.y,r.w,r.h)}),new THREE.CanvasTexture(a)}l(g,"Texture");var J=l(o=>[-9,-8,-7,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7,8,9].map(n=>{let t=new $(n);return t.mesh.position.y=n*E*2,o.add(t.mesh),t}).filter(n=>n.index>=0),"generateLanes"),Q=l((o,n)=>{let t=n.length,a=new $(t);a.mesh.position.y=t*E*2,o.add(a.mesh),n.push(a)},"addLane");function $(o){switch(this.index=o,this.type=o<=0?"field":G[Math.floor(Math.random()*G.length)],this.type){case"field":{this.type="field",this.mesh=new z;break}case"forest":{this.mesh=new z,this.occupiedPositions=new Set,this.threes=[1,2,3,4].map(()=>{let n=new j,t;do t=Math.floor(Math.random()*S);while(this.occupiedPositions.has(t));return this.occupiedPositions.add(t),n.position.x=(t*E+E/2)*2-f*2/2,this.mesh.add(n),n});break}case"car":{this.mesh=new v,this.direction=Math.random()>=.5;let n=new Set;this.vechicles=[1,2,3].map(()=>{let t=new q,a;do a=Math.floor(Math.random()*S/2);while(n.has(a));return n.add(a),t.position.x=(a*E*2+E/2)*2-f*2/2,this.direction||(t.rotation.z=Math.PI),this.mesh.add(t),t}),this.speed=B[Math.floor(Math.random()*B.length)];break}case"truck":{this.mesh=new v,this.direction=Math.random()>=.5;let n=new Set;this.vechicles=[1,2].map(()=>{let t=new V,a;do a=Math.floor(Math.random()*S/3);while(n.has(a));return n.add(a),t.position.x=(a*E*3+E/2)*2-f*2/2,this.direction||(t.rotation.z=Math.PI),this.mesh.add(t),t}),this.speed=B[Math.floor(Math.random()*B.length)];break}}}l($,"Lane");var s=Object.freeze({COW:{BASE:"rgb(255, 255, 255)",BROWN:"rgb(105, 59, 7)",PINK:"rgb(232, 106, 218)",BLACK:"rgb(0, 0, 0)"}}),L=Object.freeze({COW:{RIGHT:new N(70,70,[{x:0,y:20,w:20,h:40,color:s.COW.BROWN},{x:20,y:30,w:10,h:20,color:s.COW.BROWN},{x:30,y:0,w:10,h:10,color:s.COW.PINK}]),LEFT:new N(70,70,[{x:50,y:0,w:20,h:40,color:s.COW.BROWN},{x:40,y:0,w:10,h:30,color:s.COW.BROWN},{x:30,y:10,w:10,h:10,color:s.COW.BROWN},{x:50,y:60,w:20,h:10,color:s.COW.BROWN},{x:10,y:40,w:20,h:10,color:s.COW.BROWN},{x:30,y:0,w:10,h:10,color:s.COW.PINK}]),FRONT:new N(70,70,[{x:30,y:60,w:10,h:10,color:s.COW.BROWN},{x:0,y:40,w:30,h:30,color:s.COW.BROWN},{x:10,y:30,w:10,h:10,color:s.COW.BROWN},{x:10,y:40,w:10,h:10,color:s.COW.BLACK},{x:50,y:40,w:10,h:10,color:s.COW.BLACK},{x:0,y:30,w:10,h:10,color:s.COW.PINK},{x:60,y:30,w:10,h:10,color:s.COW.PINK},{x:20,y:20,w:30,h:20,color:s.COW.PINK}]),BACK:new N(70,70,[{x:0,y:0,w:10,h:20,color:s.COW.BROWN},{x:10,y:0,w:10,h:10,color:s.COW.BROWN},{x:30,y:50,w:10,h:10,color:s.COW.BLACK}]),TOP:new N(70,70,[{x:0,y:0,w:30,h:30,color:s.COW.BROWN},{x:30,y:0,w:10,h:10,color:s.COW.BROWN},{x:0,y:30,w:10,h:10,color:s.COW.BROWN},{x:10,y:10,w:10,h:10,color:s.COW.BLACK},{x:50,y:10,w:10,h:10,color:s.COW.BLACK},{x:0,y:60,w:20,h:10,color:s.COW.BROWN},{x:60,y:20,w:10,h:40,color:s.COW.BROWN},{x:50,y:30,w:10,h:10,color:s.COW.BROWN}])}});function ee(o){switch(o){case"fox":return pe();default:return Me()}}l(ee,"Player");function pe(){let o=new THREE.Group,n=[new THREE.MeshBasicMaterial({side:THREE.DoubleSide,map:L.COW.RIGHT}),new THREE.MeshBasicMaterial({side:THREE.DoubleSide,map:L.COW.LEFT}),new THREE.MeshBasicMaterial({side:THREE.DoubleSide,map:L.COW.FRONT}),new THREE.MeshBasicMaterial({side:THREE.DoubleSide,map:L.COW.BACK}),new THREE.MeshBasicMaterial({side:THREE.DoubleSide,map:L.COW.TOP}),new THREE.MeshBasicMaterial({color:15733283,side:THREE.DoubleSide})],t=new THREE.Mesh(new THREE.BoxGeometry(h*2,h*2,h*2),n);t.position.z=8*2,t.castShadow=!0,t.receiveShadow=!0,o.add(t);let a=new THREE.Mesh(new THREE.BoxBufferGeometry(6*2,3*2,4*2),new THREE.MeshLambertMaterial({color:s.COW.PINK,flatShading:!0}));a.position.z=h/2*2,a.position.y=h/2*2,a.castShadow=!0,a.receiveShadow=!1,o.add(a);let i=new THREE.Mesh(new THREE.BoxBufferGeometry(2*2,2*2,2*2),new THREE.MeshLambertMaterial({color:s.COW.BLACK,flatShading:!0}));i.position.z=(h+1.5)*2,i.position.y=h/3.5*2,i.position.x=h/3.3*2,i.castShadow=!0,i.receiveShadow=!1,o.add(i);let r=new THREE.Mesh(new THREE.BoxBufferGeometry(2*2,2*2,2*2),new THREE.MeshLambertMaterial({color:s.COW.BLACK,flatShading:!0}));r.position.z=(h+1.5)*2,r.position.y=h/3.5*2,r.position.x=-(h/3.3)*2,r.castShadow=!0,r.receiveShadow=!1,o.add(r);let R=new THREE.Mesh(new THREE.BoxBufferGeometry(2*2,2*2,2*2),new THREE.MeshLambertMaterial({color:s.COW.BASE,flatShading:!0}));R.position.z=(h-2)*2,R.position.y=h/3.5*2,R.position.x=-(h/1.8)*2,R.castShadow=!0,R.receiveShadow=!1,o.add(R);let x=new THREE.Mesh(new THREE.BoxBufferGeometry(2*2,2*2,2*2),new THREE.MeshLambertMaterial({color:s.COW.BASE,flatShading:!0}));x.position.z=(h-2)*2,x.position.y=h/3.5*2,x.position.x=h/1.8*2,x.castShadow=!0,x.receiveShadow=!1,o.add(x);let A=new THREE.Mesh(new THREE.BoxBufferGeometry(2*2,2*2,4*2),new THREE.MeshLambertMaterial({color:s.COW.BLACK,flatShading:!0}));return A.position.z=h/3*2,A.position.y=-(h/1.8)*2,A.castShadow=!0,A.receiveShadow=!1,o.add(A),o}l(pe,"cowPlayer");function Me(){let o=new THREE.Group,n=new THREE.Mesh(new THREE.BoxBufferGeometry(h*2,h*2,20*2),new THREE.MeshPhongMaterial({color:16777215,flatShading:!0}));n.position.z=10*2,n.castShadow=!0,n.receiveShadow=!0,o.add(n);let t=new THREE.Mesh(new THREE.BoxBufferGeometry(2*2,4*2,2*2),new THREE.MeshLambertMaterial({color:15753626,flatShading:!0}));return t.position.z=21*2,t.castShadow=!0,t.receiveShadow=!1,o.add(t),o}l(Me,"originalChickenPlayer");function N(o,n,t){let a=document.createElement("canvas");a.width=o,a.height=n;let i=a.getContext("2d");return t.forEach(r=>{i.fillStyle=r.color,i.fillRect(r.x,r.y,r.w,r.h)}),console.log(a),new THREE.CanvasTexture(a)}l(N,"CanvasTexture");var te=document.getElementById("counter"),oe=document.getElementById("end"),m=new THREE.Scene;m.background=Y;var p=new THREE.OrthographicCamera(globalThis.innerWidth/-2,globalThis.innerWidth/2,globalThis.innerHeight/2,globalThis.innerHeight/-2,.1,1e4);p.rotation.x=d.CAMERA.ROTATION.X;p.rotation.y=d.CAMERA.ROTATION.Y;p.rotation.z=d.CAMERA.ROTATION.Z;p.position.y=d.CAMERA.POSITION.Y;p.position.x=d.CAMERA.POSITION.X;p.position.z=500;var w,M,P,O,W,C,H,I,c=new ee("fox");m.add(c);var xe=new THREE.HemisphereLight(16777215,16777215,.6);m.add(xe);var T=new THREE.DirectionalLight(16777215,.6);T.position.set(d.DIR_LIGHT.POSITION.X,d.DIR_LIGHT.POSITION.Y,200);T.castShadow=!0;T.target=c;m.add(T);T.shadow.mapSize.width=2048;T.shadow.mapSize.height=2048;T.shadow.camera.left=d.DIR_LIGHT.SHADOW.CAMERA.LEFT;T.shadow.camera.right=d.DIR_LIGHT.SHADOW.CAMERA.RIGHT;T.shadow.camera.top=d.DIR_LIGHT.SHADOW.CAMERA.TOP;T.shadow.camera.bottom=d.DIR_LIGHT.SHADOW.CAMERA.BOTTON;var X=new THREE.DirectionalLight(0,.4);X.position.set(200,200,50);X.castShadow=!0;m.add(X);var ne=l(()=>{w=J(m),M=0,P=Math.floor(S/2),W=null,C=!1,H=[],I="forward",c.position.x=0,c.position.y=0,c.rotation.z=0,p.position.y=d.CAMERA.POSITION.Y,p.position.x=d.CAMERA.POSITION.X,T.position.x=d.DIR_LIGHT.POSITION.X,T.position.y=d.DIR_LIGHT.POSITION.Y},"initaliseValues");ne();var k=new THREE.WebGLRenderer({alpha:!0,antialias:!0});k.shadowMap.enabled=!0;k.shadowMap.type=THREE.PCFSoftShadowMap;k.setSize(globalThis.innerWidth,globalThis.innerHeight);document.body.appendChild(k.domElement);function y(o){if(H.length>=2)return;let n=H.reduce((t,a)=>{if(a==="forward")return{lane:t.lane+1,column:t.column};if(a==="backward")return{lane:t.lane-1,column:t.column};if(a==="left")return{lane:t.lane,column:t.column-1};if(a==="right")return{lane:t.lane,column:t.column+1}},{lane:M,column:P});if(o==="forward"){if(w[n.lane+1].type==="forest"&&w[n.lane+1].occupiedPositions.has(n.column))return;O||(C=!0),Q(m,w)}else if(o==="backward"){if(n.lane===0||w[n.lane-1].type==="forest"&&w[n.lane-1].occupiedPositions.has(n.column))return;O||(C=!0)}else if(o==="left"){if(n.column===0||w[n.lane].type==="forest"&&w[n.lane].occupiedPositions.has(n.column-1))return;O||(C=!0)}else if(o==="right"){if(n.column===S-1||w[n.lane].type==="forest"&&w[n.lane].occupiedPositions.has(n.column+1))return;O||(C=!0)}H.push(o)}l(y,"move");document.querySelector("#retry").addEventListener("click",()=>{w.forEach(o=>m.remove(o.mesh)),ne(),oe.style.visibility="hidden"});document.getElementById("forward").addEventListener("click",()=>y("forward"));document.getElementById("backward").addEventListener("click",()=>y("backward"));document.getElementById("left").addEventListener("click",()=>y("left"));document.getElementById("right").addEventListener("click",()=>y("right"));globalThis.addEventListener("keydown",o=>{o.keyCode=="38"?y("forward"):o.keyCode=="40"?y("backward"):o.keyCode=="37"?y("left"):o.keyCode=="39"&&y("right")});function ae(o){requestAnimationFrame(ae),W||(W=o);let n=o-W;if(W=o,w.forEach(t=>{if(t.type==="car"||t.type==="truck"){let a=-f*2/2-E*2*2,i=f*2/2+E*2*2;t.vechicles.forEach(r=>{t.direction?r.position.x=r.position.x<a?i:r.position.x-=t.speed/16*n:r.position.x=r.position.x>i?a:r.position.x+=t.speed/16*n})}}),C&&(O=o,C=!1),O){let t=o-O,a=Math.min(t/200,1)*E*2,i=Math.sin(Math.min(t/200,1)*Math.PI)*8*2;switch(H[0]){case"forward":{let r=M*E*2+a;switch(p.position.y=d.CAMERA.POSITION.Y+r,T.position.y=d.DIR_LIGHT.POSITION.Y+r,c.position.y=r,c.position.z=i,I){case"left":c.rotation.z=-(Math.min(t/200,1)-1)*Math.PI/2;break;case"right":c.rotation.z=(Math.min(t/200,1)-1)*Math.PI/2;break;case"backward":c.rotation.z=(Math.min(t/200,1)-1)*Math.PI;break;default:break}break}case"backward":{let r=M*E*2-a;switch(p.position.y=d.CAMERA.POSITION.Y+r,T.position.y=d.DIR_LIGHT.POSITION.Y+r,c.position.y=r,c.position.z=i,I){case"forward":c.rotation.z=-(Math.min(t/200,1)*Math.PI);break;case"left":c.rotation.z=Math.min(t/200,1)*Math.PI/2+Math.PI/2;break;case"right":c.rotation.z=-(Math.min(t/200,1)*Math.PI/2+Math.PI/2);break;default:break}break}case"left":{let r=(P*E+E/2)*2-f*2/2-a;switch(p.position.x=d.CAMERA.POSITION.X+r,T.position.x=d.DIR_LIGHT.POSITION.X+r,c.position.x=r,c.position.z=i,I){case"forward":c.rotation.z=Math.min(t/200,1)*Math.PI/2;break;case"backward":c.rotation.z=-(Math.min(t/200,1)*Math.PI/2-Math.PI);break;case"right":c.rotation.z=-(Math.min(t/200,1)*Math.PI+Math.PI/2);break;default:break}break}case"right":{let r=(P*E+E/2)*2-f*2/2+a;switch(p.position.x=d.CAMERA.POSITION.X+r,T.position.x=d.DIR_LIGHT.POSITION.X+r,c.position.x=r,c.position.z=i,I){case"forward":c.rotation.z=-(Math.min(t/200,1)*Math.PI/2);break;case"backward":c.rotation.z=Math.min(t/200,1)*Math.PI/2-Math.PI;break;case"left":c.rotation.z=Math.min(t/200,1)*Math.PI+Math.PI/2;break;default:break}break}}if(t>200){switch(H[0]){case"forward":{M++,te.innerHTML=M,I="forward";break}case"backward":{M--,te.innerHTML=M,I="backward";break}case"left":{P--,I="left";break}case"right":{P++,I="right";break}}H.shift(),O=H.length===0?null:o}}if(w[M].type==="car"||w[M].type==="truck"){let t=c.position.x-h*2/2,a=c.position.x+h*2/2,i={car:60,truck:105}[w[M].type];w[M].vechicles.forEach(r=>{let R=r.position.x-i*2/2,x=r.position.x+i*2/2;a>R&&t<x&&(oe.style.visibility="visible")})}k.render(m,p)}l(ae,"animate");requestAnimationFrame(ae);
